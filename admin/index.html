<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="robots" content="noindex" />
  <title>Admin - VIDARELAX</title>
  <link rel="icon" type="image/png" href="../images/logo.png" />

  <!-- Netlify Identity -->
  <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>

  <style>
    /* Reset b√°sico */
    * {
      box-sizing: border-box;
    }

    html, body {
      margin: 0 !important;
      padding: 0 !important;
      width: 100% !important;
      height: 100% !important;
      overflow-x: hidden !important;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif !important;
      background: #f8f9fa !important;
    }

    /* CR√çTICO: Forzar visibilidad del contenedor principal */
    #nc-root {
      display: block !important;
      visibility: visible !important;
      opacity: 1 !important;
      width: 100% !important;
      height: 100vh !important;
      min-height: 100vh !important;
      position: relative !important;
      background: #f8f9fa !important;
    }

    /* Variables de color personalizadas */
    :root {
      --primary-color: #4A7C7E;
      --secondary-color: #C4A962;
      --accent-color: #6B9FA1;
      --text-color: #2c3e50;
      --bg-color: #ffffff;
      --sidebar-bg: #f8f9fa;
    }

    /* CR√çTICO: Forzar visibilidad de componentes principales del CMS */
    [class*="App"],
    [class*="AppContainer"],
    [data-testid="nc-app"] {
      display: flex !important;
      visibility: visible !important;
      opacity: 1 !important;
      width: 100% !important;
      height: 100% !important;
      min-height: 100vh !important;
    }

    /* Personalizaci√≥n del header */
    [class*="AppHeader"],
    [class*="TopBar"],
    header[class*="Header"] {
      display: flex !important;
      visibility: visible !important;
      background: linear-gradient(135deg, var(--primary-color) 0%, var(--accent-color) 100%) !important;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1) !important;
    }

    /* CR√çTICO: Sidebar debe ser visible */
    [class*="Sidebar"],
    [class*="SidebarContainer"],
    aside,
    nav[class*="Sidebar"] {
      display: flex !important;
      visibility: visible !important;
      opacity: 1 !important;
      flex-direction: column !important;
      background: var(--sidebar-bg) !important;
      border-right: 1px solid #e0e0e0 !important;
      width: auto !important;
      min-width: 250px !important;
    }

    /* CR√çTICO: √Årea de contenido principal debe ser visible */
    [class*="MainContent"],
    [class*="ContentContainer"],
    main,
    [role="main"] {
      display: block !important;
      visibility: visible !important;
      opacity: 1 !important;
      background: white !important;
      min-height: 100vh !important;
      flex: 1 !important;
    }

    /* Botones primarios */
    button[class*="Button"][class*="primary"],
    a[class*="Button"][class*="primary"] {
      background: var(--primary-color) !important;
      border-color: var(--primary-color) !important;
      transition: all 0.3s ease !important;
    }

    button[class*="Button"][class*="primary"]:hover,
    a[class*="Button"][class*="primary"]:hover {
      background: var(--accent-color) !important;
      border-color: var(--accent-color) !important;
      transform: translateY(-2px) !important;
      box-shadow: 0 4px 12px rgba(74, 124, 126, 0.3) !important;
    }

    /* Items activos del sidebar */
    [class*="SidebarItem"][class*="active"],
    [class*="NavLink"][class*="active"] {
      background: var(--primary-color) !important;
      color: white !important;
    }

    /* Cards de colecci√≥n */
    [class*="CollectionCard"],
    [class*="Card"] {
      border-radius: 12px !important;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08) !important;
      transition: all 0.3s ease !important;
      background: white !important;
    }

    [class*="CollectionCard"]:hover,
    [class*="Card"]:hover {
      transform: translateY(-4px) !important;
      box-shadow: 0 4px 16px rgba(0,0,0,0.12) !important;
    }

    /* Inputs */
    input[type="text"],
    input[type="email"],
    input[type="password"],
    input[type="search"],
    textarea,
    select {
      border: 1px solid #e0e0e0 !important;
      border-radius: 8px !important;
      padding: 0.75rem !important;
      transition: all 0.3s ease !important;
      background: white !important;
    }

    input:focus,
    textarea:focus,
    select:focus {
      border-color: var(--primary-color) !important;
      box-shadow: 0 0 0 3px rgba(74, 124, 126, 0.1) !important;
      outline: none !important;
    }

    /* Tabs */
    [class*="Tab"] {
      border-radius: 8px 8px 0 0 !important;
    }

    [class*="Tab"][class*="active"] {
      background: var(--primary-color) !important;
      color: white !important;
    }

    /* Scrollbar personalizada */
    ::-webkit-scrollbar {
      width: 10px;
      height: 10px;
    }

    ::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--primary-color);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--accent-color);
    }
  </style>
</head>
<body>
  <!-- Decap CMS -->
  <script src="https://unpkg.com/decap-cms@^3.0.0/dist/decap-cms.js"></script>

  <script>
    (function() {
      'use strict';

      console.log('üé® VIDARELAX Admin Panel - Inicializando...');

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // PASO 1: CONFIGURAR NETLIFY IDENTITY
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      if (window.netlifyIdentity) {
        window.netlifyIdentity.on("init", user => {
          console.log('üîê Netlify Identity inicializado', user ? '(Usuario autenticado)' : '(Sin usuario)');

          if (!user) {
            // Si no hay usuario, configurar redirect despu√©s de login
            window.netlifyIdentity.on("login", () => {
              console.log('‚úÖ Login exitoso - Recargando p√°gina...');
              document.location.href = "/admin/";
            });
          } else {
            // Usuario ya autenticado, iniciar carga del CMS
            console.log('üë§ Usuario ya autenticado, esperando carga del CMS...');
            initializeCMS();
          }
        });
      }

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // PASO 2: ESPERAR CARGA COMPLETA DEL CMS
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      function initializeCMS() {
        console.log('‚è≥ Esperando que el CMS se renderice completamente...');

        let attempts = 0;
        const maxAttempts = 50; // 10 segundos m√°ximo (50 * 200ms)

        const checkCMSReady = setInterval(() => {
          attempts++;

          // Buscar elementos cr√≠ticos del CMS
          const root = document.getElementById('nc-root');
          const app = document.querySelector('[class*="App"], [data-testid="nc-app"]');
          const sidebar = document.querySelector('[class*="Sidebar"], aside');
          const mainContent = document.querySelector('[class*="MainContent"], main, [role="main"]');

          console.log(`üîç Intento ${attempts}/${maxAttempts}:`, {
            root: !!root,
            app: !!app,
            sidebar: !!sidebar,
            mainContent: !!mainContent
          });

          // Verificar si TODOS los elementos cr√≠ticos existen
          if (root && app && (sidebar || mainContent)) {
            clearInterval(checkCMSReady);
            console.log('‚úÖ CMS completamente cargado - Aplicando estilos y configuraci√≥n');

            // Aplicar estilos y configuraci√≥n
            forceCMSVisibility();
            startContinuousMonitoring();

            // Notificar √©xito
            console.log('üéâ VIDARELAX Admin Panel - Listo para usar');

          } else if (attempts >= maxAttempts) {
            clearInterval(checkCMSReady);
            console.error('‚ùå Timeout: El CMS no se carg√≥ completamente');

            // Intentar forzar visibilidad de todos modos
            forceCMSVisibility();
          }
        }, 200); // Verificar cada 200ms
      }

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // PASO 3: FORZAR VISIBILIDAD DE TODOS LOS ELEMENTOS
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      function forceCMSVisibility() {
        console.log('üîß Forzando visibilidad de elementos del CMS...');

        // Root container
        const root = document.getElementById('nc-root');
        if (root) {
          root.style.cssText = `
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            width: 100% !important;
            height: 100vh !important;
            position: relative !important;
          `;
          console.log('  ‚úì nc-root visible');
        }

        // App containers
        const apps = document.querySelectorAll('[class*="App"], [class*="AppContainer"], [data-testid="nc-app"]');
        apps.forEach((el, index) => {
          el.style.cssText = `
            display: flex !important;
            visibility: visible !important;
            opacity: 1 !important;
            width: 100% !important;
            height: 100% !important;
            flex-direction: row !important;
          `;
          console.log(`  ‚úì App container ${index + 1} visible`);
        });

        // Sidebar
        const sidebars = document.querySelectorAll('[class*="Sidebar"], aside, nav[class*="Sidebar"]');
        sidebars.forEach((el, index) => {
          el.style.cssText = `
            display: flex !important;
            visibility: visible !important;
            opacity: 1 !important;
            flex-direction: column !important;
            width: auto !important;
            min-width: 250px !important;
          `;
          console.log(`  ‚úì Sidebar ${index + 1} visible`);
        });

        // Main content
        const mains = document.querySelectorAll('[class*="MainContent"], [class*="ContentContainer"], main, [role="main"]');
        mains.forEach((el, index) => {
          el.style.cssText = `
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
            flex: 1 !important;
            width: 100% !important;
          `;
          console.log(`  ‚úì Main content ${index + 1} visible`);
        });

        // Headers
        const headers = document.querySelectorAll('[class*="AppHeader"], [class*="TopBar"], header');
        headers.forEach((el, index) => {
          el.style.cssText = `
            display: flex !important;
            visibility: visible !important;
            opacity: 1 !important;
          `;
          console.log(`  ‚úì Header ${index + 1} visible`);
        });

        console.log('‚úÖ Todos los estilos de visibilidad aplicados');
      }

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // PASO 4: MONITOREO CONTINUO (Sistema de recuperaci√≥n)
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      function startContinuousMonitoring() {
        console.log('üëÅÔ∏è Iniciando monitoreo continuo del DOM...');

        // Re-aplicar estilos cada 2 segundos durante el primer minuto
        let monitoringCount = 0;
        const maxMonitoring = 30; // 30 veces = 1 minuto

        const monitoringInterval = setInterval(() => {
          monitoringCount++;
          forceCMSVisibility();

          if (monitoringCount >= maxMonitoring) {
            clearInterval(monitoringInterval);
            console.log('‚úÖ Monitoreo intensivo completado - Cambiando a monitoreo ligero');
            startLightMonitoring();
          }
        }, 2000); // Cada 2 segundos

        // MutationObserver para detectar cambios
        const observer = new MutationObserver((mutations) => {
          // Verificar si alg√∫n elemento cr√≠tico fue ocultado
          const root = document.getElementById('nc-root');
          if (root && (root.style.display === 'none' || root.style.visibility === 'hidden')) {
            console.warn('‚ö†Ô∏è Elemento cr√≠tico ocultado detectado - Restaurando...');
            forceCMSVisibility();
          }
        });

        observer.observe(document.body, {
          childList: true,
          subtree: true,
          attributes: true,
          attributeFilter: ['style', 'class']
        });

        console.log('‚úÖ MutationObserver activo');
      }

      // Monitoreo ligero cada 10 segundos indefinidamente
      function startLightMonitoring() {
        setInterval(() => {
          const root = document.getElementById('nc-root');
          const app = document.querySelector('[class*="App"]');

          if (root && app) {
            // Solo verificar visibilidad, no forzar
            if (root.style.display === 'none' || !app.offsetParent) {
              console.warn('‚ö†Ô∏è Problema de visibilidad detectado - Restaurando...');
              forceCMSVisibility();
            }
          }
        }, 10000); // Cada 10 segundos
      }

      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      // PASO 5: INICIALIZAR EN CARGA DE P√ÅGINA
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      window.addEventListener('load', () => {
        console.log('üìÑ P√°gina cargada - Verificando estado de autenticaci√≥n...');

        // Si Netlify Identity no est√° disponible, inicializar de todos modos
        if (!window.netlifyIdentity) {
          console.warn('‚ö†Ô∏è Netlify Identity no disponible - Inicializando CMS de todos modos');
          setTimeout(initializeCMS, 500);
        }
      });

      // Backup: Inicializar despu√©s de 2 segundos si nada m√°s funciona
      setTimeout(() => {
        const root = document.getElementById('nc-root');
        if (root && !root.querySelector('[class*="App"]')) {
          console.warn('‚ö†Ô∏è Iniciando carga de emergencia del CMS...');
          initializeCMS();
        }
      }, 2000);

    })();
  </script>
</body>
</html>
